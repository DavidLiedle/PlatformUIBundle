<link rel="import" href="../../../assets/ezplatform/ez-field-edit/ez-field-edit.html">
<link rel="import" href="ez-map.html">

<style>
ez-field-edit-ezgmaplocation {
    display: block;
    padding: 1em;
}

ez-field-edit-ezgmaplocation.is-invalid fieldset {
    background: #fdd;
}
</style>

<script>
(function () {
    class eZFieldEditMapLocation extends customElements.get('ez-field-edit') {
        static get is() {
            return 'ez-field-edit-ezgmaplocation';
        }

        constructor() {
            super();
        }

        _getFieldValue(subField) {
            return this._getFieldEdit(subField).value;
        }

        _getFieldEdit(subField) {
            return this.querySelector('input[name*="' + subField + '"]');
        }

        connectedCallback() {
            super.connectedCallback();

            const map = document.createElement('ez-map');
            map.latitude = this._getFieldValue('latitude');
            map.longitude = this._getFieldValue('longitude');
            map.address = this._getFieldValue('address');

            this.querySelector('fieldset').appendChild(map);
            map.addEventListener('coordinatesUpdate', function (e) {
                this._getFieldEdit('latitude').value = e.detail.latitude.toFixed(6);
                this._getFieldEdit('longitude').value = e.detail.longitude.toFixed(6);
            }.bind(this));
        }
    }

    customElements.define(eZFieldEditMapLocation.is, eZFieldEditMapLocation);
})();
</script>
